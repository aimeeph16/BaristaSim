<html>
    <head>
        <title>Babylon.js sample code</title>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <style>
            body,#renderCanvas { width: 100%; height: 100%;}
        </style>
    </head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script type="text/javascript">
        const canvas = document.getElementById("renderCanvas");
        //const engine = new BABYLON.Engine(canvas, true);
    
        const createScene = function() {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3.Black;

            const alpha =  Math.PI/2;
            const beta = Math.PI/2;
            const radius = 10;
            const target = new BABYLON.Vector3(-44, 170, -323);

            const camera = new BABYLON.ArcRotateCamera("Camera", alpha, beta, radius, target, scene);
            camera.attachControl(canvas, true);
            //camera.position = new BABYLON.Vector3(-44, 170, -323);
            //camera.rotation.y += 9.5;

            var environment =  scene.createDefaultEnvironment({ 
                    createSkybox: false,
                    // skyboxSize: 150,
                    // skyboxColor: BABYLON.Color3.Teal(),
                    createGround: true,
                    groundSize: 2000,
                    // groundColor: BABYLON.Color3.Green(),
                    enableGroundShadow: true, 
                    groundYBias: 1 
            });

            // var skyMaterial = new BABYLON.StandardMaterial("skybox", scene);
            //     skyMaterial.backFaceCulling = false;
            //     skyMaterial.reflectionTexture = new BABYLON.CubeTexture("Assets/skybox2", scene);
            //     skyMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            //     skyMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
            //     skyMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
                
            // var skybox = BABYLON.MeshBuilder.CreateBox("skyBox", {size:2000.0}, scene);
            //     skybox.position = new BABYLON.Vector3(0,0,-300);
            //     skybox.material = skyMaterial;

            var vrHelper = scene.createDefaultVRExperience({
                createDeviceOrientationCamera: false
            })

            vrHelper.enableTeleportation({floorMeshes: [environment.ground]})
            
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));

            var cafe = BABYLON.SceneLoader.Append("Assets/coffee-shop/", "scene.gltf", scene, function (meshes) {    
                //scene.createDefaultCameraOrLight(true, true, true); 
            });

            // const ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 4, height: 4});

            // const camera = new BABYLON.ArcRotateCamera("Camera", alpha, beta, radius, target, scene);
            // camera.attachControl(canvas, true);

            // const box = BABYLON.MeshBuilder.CreateBox("box", {});
            // box.position.x = 0.5;
            // box.position.y = 1;

            // const boxMaterial = new BABYLON.StandardMaterial("material", scene);
            // boxMaterial.diffuseColor = BABYLON.Color3.Random();
            // box.material = boxMaterial;

            // box.actionManager = new BABYLON.ActionManager(scene);
            // box.actionManager.registerAction(new BABYLON.ExecuteCodeAction(
            //     BABYLON.ActionManager.OnPickTrigger, 
            //     function (evt) {
            //         const sourceBox = evt.meshUnderPointer;

            //         //move the box upright
            //         sourceBox.position.x += 0.1;
            //         sourceBox.position.y += 0.1;

            //         //update the color
            //         boxMaterial.diffuseColor = BABYLON.Color3.Random();
            //     }
            // ));
            
                // //-------------- vr stuff ---------------//
                // const xrPromise = scene.createDefaultXRExperienceAsync({
                //     floorMeshes: [ground]
                // });
                
                // return xrPromise.then((xrExperience) => {
                //     console.log("Done, WebXR is enabled.");
                //     return scene;
                // });
                // //-------------- vr stuff ---------------//
            return scene;
        }

        // createScene().then(sceneToRender => {
        //     engine.runRenderLoop(() => sceneToRender.render());
        // });
        // const sceneToRender = createScene();

        var engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });
            var scene = createScene();

        engine.runRenderLoop(function () {
            if (scene) {
                scene.render();
            }
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>